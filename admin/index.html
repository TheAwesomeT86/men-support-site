<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin | MEN Support</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>window.CMS_MANUAL_INIT = true;</script>
    <script src="https://cdn.jsdelivr.net/npm/decap-cms@3.9.0/dist/decap-cms.js"></script>
  </head>
  <body>
    <!-- Decap CMS root container -->
    <div id="nc-root"></div>
    <noscript>This page requires JavaScript to run the CMS.</noscript>
    <p style="text-align:center; margin-top:12px;">
      <button id="loginBtn" style="padding:8px 12px; border-radius:8px; border:1px solid #ddd; cursor:pointer;">Log in</button>
    </p>
    <script>
      // Initialize CMS after DOM is ready to ensure #nc-root exists
      document.addEventListener('DOMContentLoaded', function () {
        if (window.CMS && typeof window.CMS.init === 'function') {
          window.CMS.init();
        }
      });

      if (window.netlifyIdentity) {
        window.netlifyIdentity.on('init', (user) => {
          if (!user) {
            // Open the login/signup modal automatically on first visit
            window.netlifyIdentity.open();
            window.netlifyIdentity.on('login', () => {
              document.location.href = '/admin/';
            });
          }
        });
        // Initialize in case it hasn't yet
        window.netlifyIdentity.init();
      }
      // Fallback login button
      const btn = document.getElementById('loginBtn');
      if (btn && window.netlifyIdentity) {
        btn.addEventListener('click', () => window.netlifyIdentity.open());
      }
    </script>
  </body>
</html>
